<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MessFlow</title>

    <!-- iOS Design System CSS -->
    <link rel="stylesheet" href="mobile.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sf': ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        'ios-blue': '#007AFF',
                        'ios-green': '#34C759',
                        'ios-red': '#FF3B30',
                        'ios-orange': '#FF9500',
                        'ios-purple': '#AF52DE',
                        'ios-gray': '#8E8E93',
                        'ios-bg': '#F2F2F7',
                    }
                }
            }
        }
    </script>

    <!-- SF Symbols Style Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0..1,0"
        rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007AFF">

    <!-- iOS PWA Support -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MessFlow">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">

    <!-- iOS Specific Styles -->
    <style>
        /* Smooth scrolling for iOS */
        * {
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent pull-to-refresh */
        body {
            overscroll-behavior-y: contain;
        }

        /* iOS safe areas */
        @supports (padding: env(safe-area-inset-top)) {
            .top-bar {
                padding-top: calc(12px + env(safe-area-inset-top));
            }

            .bottom-nav {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>

<body>

    <div id="app-root">

        <!-- Drawer Overlay -->
        <div class="drawer-overlay" id="drawer-overlay"></div>

        <!-- Navigation Drawer -->
        <nav class="nav-drawer" id="nav-drawer">
            <div class="drawer-header">
                <span class="material-symbols-outlined">restaurant_menu</span>
                <span style="font-size: 22px; font-weight: 700; letter-spacing: -0.5px;">MessFlow</span>
            </div>

            <a href="#" class="drawer-item active" onclick="navigate('home')">
                <span class="material-symbols-outlined">inbox</span>
                Entries
            </a>
            <a href="#" class="drawer-item" onclick="navigate('bill')">
                <span class="material-symbols-outlined">receipt_long</span>
                Generate Bill
            </a>
            <a href="#" class="drawer-item" onclick="navigate('pricing')">
                <span class="material-symbols-outlined">price_change</span>
                Pricing Rules
            </a>
            <div class="drawer-divider"></div>
            <a href="#" class="drawer-item" onclick="toggleTheme()">
                <span class="material-symbols-outlined">dark_mode</span>
                Toggle Theme
            </a>
            <a href="#" class="drawer-item" onclick="navigate('reports')">
                <span class="material-symbols-outlined">analytics</span>
                Reports & Analytics
            </a>
            <a href="#" class="drawer-item" onclick="navigate('activity')">
                <span class="material-symbols-outlined">history</span>
                Activity Log
            </a>
            <a href="#" class="drawer-item" onclick="navigate('settings')">
                <span class="material-symbols-outlined">settings</span>
                Data & Settings
            </a>
        </nav>

        <!-- Top Search Pill -->
        <!-- Sticky Top Bar -->
        <div class="top-bar">
            <!-- Search Container (Visible on Home) -->
            <div class="search-pill" id="top-search-bar">
                <button class="icon-btn" onclick="toggleDrawer()">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <input type="text" class="search-input" placeholder="Search entries..." id="search-input"
                    oninput="handleSearch(this.value)">

                <!-- Filter Trigger -->
                <button class="icon-btn" onclick="openSearchFilterModal()"
                    style="margin-right:4px; color:var(--md-sys-color-on-surface-variant);">
                    <span class="material-symbols-outlined">tune</span>
                </button>

                <div class="avatar" id="user-avatar">AD</div>
            </div>

            <!-- Page Header (Visible on other pages) -->
            <div class="page-header" id="top-page-header" style="display:none;">
                <button class="icon-btn" onclick="toggleDrawer()">
                    <span class="material-symbols-outlined">menu</span>
                </button>
                <div class="page-title" id="page-title-text">Section Name</div>
            </div>

            <!-- Filter Chips Row (Google Style) -->
            <div class="filter-chips-row" id="filter-chips-row">
                <!-- Chips injected by JS -->
            </div>

            <!-- Global Loader Progress (Hidden by default) -->
            <div id="global-loader"
                style="display:none; position:absolute; bottom:-4px; left:0; width:100%; height:4px; background:var(--md-sys-color-surface-variant); overflow:hidden;">
                <div class="loader-bar"></div>
            </div>
        </div>

        <!-- Full Screen Overlay Loader for Blocking Actions -->
        <div id="full-screen-loader"
            style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999; background:rgba(0,0,0,0.3); align-items:center; justify-content:center; flex-direction:column;">
            <div class="spinner"></div>
            <div id="loader-text"
                style="margin-top:16px; color:white; font-weight:500; text-shadow:0 1px 2px rgba(0,0,0,0.5);">
                Processing...</div>
        </div>

        <!-- Main Content -->
        <main class="content" id="main-content">

            <!-- View: Home -->
            <div id="view-home" class="view-section active">

                <!-- Quick Stats Card -->
                <div class="card stats-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-size:12px; font-weight:500; opacity:0.8; text-transform:uppercase;">This
                                Month</div>
                            <div style="font-size:28px; font-weight:bold; margin-top:4px;" id="stats-month-amount">₹0
                            </div>
                            <div style="font-size:12px; opacity:0.8; margin-top:2px;" id="stats-month-count">0 Tiffins
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:12px; font-weight:500; opacity:0.8; text-transform:uppercase;">Today
                            </div>
                            <div style="font-size:24px; font-weight:bold; margin-top:4px;" id="stats-today-total">0
                            </div>
                            <div style="font-size:12px; opacity:0.8;" id="stats-today-date">-</div>
                        </div>
                    </div>
                </div>

                <div class="section-title">TODAY</div>
                <div id="entries-list-today">
                    <div class="mail-item" style="opacity: 0.5; justify-content: center;">
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="section-title">HISTORY</div>
                <div id="entries-list-week">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- View: Bill Generation -->
            <div id="view-bill" class="view-section">
                <div class="section-title">BILL GENERATION</div>

                <div style="padding: 16px 0;">
                    <!-- Filter Type Selection -->
                    <div class="input-group"
                        style="background: var(--md-sys-color-surface-container); border-radius: 8px; margin-bottom: 12px;">
                        <label
                            style="font-size: 12px; font-weight: 500; color: var(--md-sys-color-primary); padding: 8px 12px 0;">Select
                            Period</label>
                        <select class="m3-input" id="bill-filter-type" style="padding-top: 8px;"
                            onchange="toggleBillDateInputs()">
                            <option value="month">By Month</option>
                            <option value="custom">Custom Date Range</option>
                        </select>
                    </div>

                    <!-- Month Dropdown (default) -->
                    <div id="bill-month-container" class="input-group"
                        style="background: var(--md-sys-color-surface-container); border-radius: 8px;">
                        <select class="m3-input" id="bill-month-select" style="padding-top: 16px;">
                            <!-- Options populated by JS -->
                        </select>
                    </div>

                    <!-- Custom Date Range (hidden by default) -->
                    <div id="bill-custom-container" style="display: none;">
                        <div class="input-group"
                            style="background: var(--md-sys-color-surface-container); border-radius: 8px; margin-bottom: 12px;">
                            <label class="floating-label"
                                style="transform: translateY(-12px) scale(0.75); color: var(--md-sys-color-primary);">Start
                                Date</label>
                            <input type="date" class="m3-input" id="bill-start-date" style="padding-top: 16px;">
                        </div>
                        <div class="input-group"
                            style="background: var(--md-sys-color-surface-container); border-radius: 8px;">
                            <label class="floating-label"
                                style="transform: translateY(-12px) scale(0.75); color: var(--md-sys-color-primary);">End
                                Date</label>
                            <input type="date" class="m3-input" id="bill-end-date" style="padding-top: 16px;">
                        </div>
                    </div>

                    <button class="btn-filled" style="margin-top: 16px;" onclick="generateBillPreview()">
                        <span class="material-symbols-outlined">receipt</span>
                        Generate Bill
                    </button>
                </div>

                <div id="bill-card"
                    style="display:none; background: var(--md-sys-color-surface-container); border-radius: 16px; padding: 20px; box-shadow: var(--elevation-1); margin-top: 16px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom: 20px;">
                        <h3 style="margin:0; font-size: 18px;">Bill Summary</h3>
                        <span id="bill-period-display"
                            style="color: var(--md-sys-color-on-surface-variant); font-size: 14px;"></span>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 12px; color: var(--md-sys-color-on-surface-variant);">Morning</div>
                            <div id="bill-morning-count" style="font-size: 20px; font-weight: 500;">0</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--md-sys-color-on-surface-variant);">Evening</div>
                            <div id="bill-evening-count" style="font-size: 20px; font-weight: 500;">0</div>
                        </div>
                    </div>

                    <div style="border-top: 1px solid var(--md-sys-color-outline); padding-top: 16px; opacity: 0.5;">
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items: center;">
                        <span style="font-weight: 500;">Grand Total</span>
                        <span id="bill-total-amount"
                            style="font-size: 24px; font-weight: 600; color: var(--md-sys-color-primary);">₹0</span>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 16px;">
                        <button class="btn-text" style="width:100%; border:1px solid var(--md-sys-color-outline);"
                            onclick="printBill()">
                            <span class="material-symbols-outlined"
                                style="vertical-align: middle; font-size: 18px; margin-right: 8px;">print</span>
                            Print / PDF
                        </button>
                        <button class="btn-text" style="width:100%; border:1px solid var(--md-sys-color-outline);"
                            onclick="exportBillExcel()">
                            <span class="material-symbols-outlined"
                                style="vertical-align: middle; font-size: 18px; margin-right: 8px;">table_view</span>
                            Excel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hidden Container for Printable Bill -->
            <div id="printable-bill-container" style="display:none;"></div>

            <!-- View: Reports & Analytics -->
            <div id="view-reports" class="view-section">
                <div class="section-title">REPORTS & ANALYTICS</div>

                <!-- Controls: Month & Export -->
                <div style="display:flex; gap:12px; margin-bottom:16px;">
                    <div class="input-group"
                        style="flex:1; margin-bottom:0; border-radius:8px; border:1px solid var(--md-sys-color-outline-variant); background:var(--md-sys-color-surface);">
                        <select id="report-month-select" class="m3-input" onchange="renderCharts()"
                            style="border:none; padding:12px;">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <button class="icon-btn" onclick="exportReportCSV()"
                        style="background:var(--md-sys-color-secondary-container); color:var(--md-sys-color-on-secondary-container); width:48px; height:48px; border-radius:8px;">
                        <span class="material-symbols-outlined">download</span>
                    </button>
                </div>

                <!-- Google Analytics Style Cards -->
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:24px;">
                    <!-- Card 1: Morning -->
                    <div class="card analytics-card">
                        <div class="analytics-label">Morning</div>
                        <div class="analytics-value" id="report-morning">0</div>
                        <div class="analytics-bar" style="background:#8e24aa;"></div>
                    </div>
                    <!-- Card 2: Evening -->
                    <div class="card analytics-card">
                        <div class="analytics-label">Evening</div>
                        <div class="analytics-value" id="report-evening">0</div>
                        <div class="analytics-bar" style="background:#5d4037;"></div>
                    </div>
                    <!-- Card 3: Total -->
                    <div class="card analytics-card">
                        <div class="analytics-label">Total Tiffins</div>
                        <div class="analytics-value" id="report-total">0</div>
                        <div class="analytics-bar" style="background:#b71c1c;"></div>
                    </div>
                    <!-- Card 4: Amount -->
                    <div class="card analytics-card">
                        <div class="analytics-label">Revenue</div>
                        <div class="analytics-value" id="report-amount">₹0</div>
                        <div class="analytics-bar" style="background:#004d40;"></div>
                    </div>
                </div>

                <!-- AI Insight -->
                <div id="ai-insight-card" class="card"
                    style="margin-top:0; margin-bottom:24px; background:var(--md-sys-color-secondary-container); color:var(--md-sys-color-on-secondary-container); display:none;">
                    <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
                        <span class="material-symbols-outlined" style="font-size:18px;">auto_awesome</span>
                        <span style="font-size:12px; font-weight:600;">AI FORECAST</span>
                    </div>
                    <div id="ai-insight-text" style="font-size:14px;"></div>
                </div>

                <!-- Charts -->
                <div class="card" style="margin-top:0; padding:16px;">
                    <div style="font-size:14px; font-weight:500; margin-bottom:12px;">Daily Trend</div>
                    <canvas id="chart-trend"></canvas>
                </div>

                <div class="card" style="margin-top:16px; padding:16px;">
                    <div style="font-size:14px; font-weight:500; margin-bottom:12px;">Morning vs Evening</div>
                    <canvas id="chart-comparison"></canvas>
                </div>

                <div class="card" style="margin-top:16px; padding:16px;">
                    <div style="font-size:14px; font-weight:500; margin-bottom:12px;">Monthly History (Last 6 Months)
                    </div>
                    <canvas id="chart-history"></canvas>
                </div>
            </div>

            <!-- View: Pricing Rules -->
            <div id="view-pricing" class="view-section">
                <div class="section-title">PRICING RULES</div>
                <div id="pricing-list">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- View: Activity Log -->
            <div id="view-activity" class="view-section">
                <div class="section-title">ACTIVITY LOG</div>
                <div id="activity-list">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- View: Settings / Data -->
            <div id="view-settings" class="view-section">
                <div class="section-title">DATA MANAGEMENT</div>

                <div class="mail-item" onclick="exportData()">
                    <div class="mail-avatar"
                        style="background:var(--md-sys-color-secondary-container); color:var(--md-sys-color-on-secondary-container);">
                        <span class="material-symbols-outlined">download</span>
                    </div>
                    <div class="mail-content">
                        <div class="mail-header">
                            <span class="mail-sender">Backup Data</span>
                        </div>
                        <div class="mail-snippet">Download all entries as JSON</div>
                    </div>
                </div>

                <div class="mail-item" onclick="triggerImport()">
                    <div class="mail-avatar"
                        style="background:var(--md-sys-color-secondary-container); color:var(--md-sys-color-on-secondary-container);">
                        <span class="material-symbols-outlined">upload</span>
                    </div>
                    <div class="mail-content">
                        <div class="mail-header">
                            <span class="mail-sender">Restore Data</span>
                        </div>
                        <div class="mail-snippet">Import entries from JSON backup</div>
                    </div>
                </div>

                <input type="file" id="import-file" style="display:none;" onchange="importData(this)">

                <div class="mail-item" onclick="clearAllData()">
                    <div class="mail-avatar" style="background:#fce8e6; color:#c5221f;">
                        <span class="material-symbols-outlined">delete_forever</span>
                    </div>
                    <div class="mail-content">
                        <div class="mail-header">
                            <span class="mail-sender">Clear All Data</span>
                        </div>
                        <div class="mail-snippet" style="color:#c5221f;">Permanently delete all entries</div>
                    </div>
                </div>
            </div>

        </main>

        <!-- FAB (Add Entry/Rule) -->
        <button class="fab" id="fab-add" onclick="handleFabClick()">
            <span class="material-symbols-outlined fab-icon">edit</span>
            Compose
        </button>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="navigate('home')">
                <div class="nav-icon-container">
                    <span class="material-symbols-outlined">mail</span>
                </div>
                <span class="nav-label">Entries</span>
            </div>
            <div class="nav-item" onclick="navigate('bill')">
                <div class="nav-icon-container">
                    <span class="material-symbols-outlined">receipt_long</span>
                </div>
                <span class="nav-label">Bill</span>
            </div>
            <div class="nav-item" onclick="navigate('reports')">
                <div class="nav-icon-container">
                    <span class="material-symbols-outlined">analytics</span>
                </div>
                <span class="nav-label">Reports</span>
            </div>
        </nav>

        <!-- Add Entry Modal -->
        <div class="modal" id="entry-modal">
            <div class="modal-content">
                <h3 class="modal-title" id="modal-title">New Entry</h3>

                <div class="input-group">
                    <input type="date" class="m3-input" id="new-date" placeholder=" ">
                    <label class="m3-label">Date</label>
                </div>

                <div class="input-group">
                    <input type="number" class="m3-input" id="new-morning" placeholder=" " value="0" min="0">
                    <label class="m3-label">Morning Tiffins</label>
                </div>

                <div class="input-group">
                    <input type="number" class="m3-input" id="new-evening" placeholder=" " value="0" min="0">
                    <label class="m3-label">Evening Tiffins</label>
                </div>

                <div class="modal-actions" style="justify-content: space-between;">
                    <button class="btn-text btn-delete" id="delete-entry-btn" onclick="deleteEntry()"
                        style="color: #f44336; display: none;">
                        <span class="material-symbols-outlined"
                            style="font-size: 18px; vertical-align: middle;">delete</span>
                        Delete
                    </button>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-text" onclick="closeModal()">Cancel</button>
                        <button class="btn-text" onclick="saveEntry()">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Entry Details Modal (Edit/Delete) -->
        <div class="modal" id="details-modal">
            <div class="modal-content">
                <input type="hidden" id="detail-id"> <!-- Hidden ID -->
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 class="modal-title" id="detail-date" style="margin:0;">-</h3>
                    <div style="background:var(--md-sys-color-primary-container); color:var(--md-sys-color-on-primary-container); padding:4px 12px; border-radius:12px; font-weight:bold;"
                        id="detail-total">0</div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-bottom:24px;">
                    <div class="detail-stat-box">
                        <span style="display:block; font-size:14px; opacity:0.7; margin-bottom:4px;">Morning</span>
                        <span style="font-size:24px; font-weight:500;" id="detail-morning">0</span>
                    </div>
                    <div class="detail-stat-box">
                        <span style="display:block; font-size:14px; opacity:0.7; margin-bottom:4px;">Evening</span>
                        <span style="font-size:24px; font-weight:500;" id="detail-evening">0</span>
                    </div>
                </div>

                <div style="margin-bottom:24px; text-align:center;">
                    <span style="font-size:16px;">Total Amount:</span>
                    <span style="font-size:24px; font-weight:bold; color:var(--md-sys-color-primary); margin-left:8px;"
                        id="detail-amount">₹0</span>
                    <!-- Actions: Delete (Left), Actions (Right) -->
                    <div class="modal-actions"
                        style="justify-content: space-between; align-items: center; margin-top: 24px;">
                        <!-- Delete Button (Icon Only or Icon+Text Red) -->
                        <button class="btn-text btn-delete" onclick="deleteEntry()"
                            style="padding:0 12px; display:inline-flex; align-items:center;">
                            <span class="material-symbols-outlined"
                                style="font-size:18px; margin-right:6px;">delete</span>
                            <span style="font-size:14px; font-weight:500;">Delete</span>
                        </button>

                        <div style="display:flex; gap:8px;">
                            <button class="btn-text" onclick="closeModal()"
                                style="color:var(--md-sys-color-on-surface-variant); padding:0 12px;">Close</button>
                            <button class="btn-text" onclick="editEntry()"
                                style="background:var(--md-sys-color-primary-container); color:var(--md-sys-color-on-primary-container); padding:10px 20px; display:inline-flex; align-items:center; justify-content:center;">
                                <span class="material-symbols-outlined"
                                    style="font-size:20px; margin-right:6px;">edit</span>
                                Edit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Pricing Rule Modal -->
        <div class="modal" id="pricing-modal">
            <div class="modal-content">
                <input type="hidden" id="price-id">
                <h3 class="modal-title">New Pricing Rule</h3>

                <div class="input-group">
                    <input type="date" class="m3-input" id="price-start" placeholder=" ">
                    <label class="m3-label">Start Date</label>
                </div>
                <div class="input-group">
                    <input type="date" class="m3-input" id="price-end" placeholder=" ">
                    <label class="m3-label">End Date (Optional)</label>
                </div>

                <div class="input-group">
                    <input type="number" class="m3-input" id="price-morning" placeholder=" " value="46">
                    <label class="m3-label">Morning Rate (₹)</label>
                </div>

                <div class="input-group">
                    <input type="number" class="m3-input" id="price-evening" placeholder=" " value="46">
                    <label class="m3-label">Evening Rate (₹)</label>
                </div>

                <div class="modal-actions">
                    <button class="btn-text" onclick="closeModal()">Cancel</button>
                    <button class="btn-text" onclick="savePricingRule()">Save Rule</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Advanced Filter Modal -->
    <div class="modal" id="search-filter-modal">
        <div class="modal-content">
            <h3 class="modal-title" style="margin-top:0; margin-bottom:12px; font-size:18px;">Search Filters</h3>

            <!-- Filter Sections -->
            <div class="filter-section">
                <label>Filter By</label>
                <div class="chip-group-select">
                    <button class="filter-chip-option active" data-type="all"
                        onclick="setFilterType('all')">All</button>
                    <button class="filter-chip-option" data-type="date" onclick="setFilterType('date')">Date</button>
                    <button class="filter-chip-option" data-type="month" onclick="setFilterType('month')">Month</button>
                    <button class="filter-chip-option" data-type="year" onclick="setFilterType('year')">Year</button>
                </div>
            </div>

            <!-- Specific Filter Inputs -->
            <div id="filter-input-date" class="filter-input-group" style="display:none;">
                <label>Select Date</label>
                <input type="date" id="adv-filter-date">
            </div>

            <div id="filter-input-month" class="filter-input-group" style="display:none;">
                <label>Select Month</label>
                <input type="month" id="adv-filter-month">
            </div>

            <div id="filter-input-year" class="filter-input-group" style="display:none;">
                <label>Select Year</label>
                <div id="year-chips-container" style="display:flex; gap:8px; flex-wrap:wrap;">
                    <!-- Years injected by JS -->
                </div>
            </div>

            <div class="modal-actions" style="margin-top:20px;">
                <button class="btn-text" onclick="closeModal()"
                    style="color:var(--md-sys-color-on-surface-variant);">Cancel</button>
                <button class="btn-text" onclick="clearAllFilters()"
                    style="color:var(--md-sys-color-error);">Reset</button>
                <button class="btn-text" onclick="applyAdvancedFilters()"
                    style="background:var(--md-sys-color-primary-container); color:var(--md-sys-color-on-primary-container);">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Navigation -->


    </div> <!-- End app-root -->

    <!-- Printable Container (Hidden normally, Visible on Print) -->
    <div id="printable-bill-container" style="display:none;"></div>


    <!-- INSTANT CACHE LOADER - Pre-loads data from localStorage for super fast startup -->
    <script>
            (function () {
                window.MESS_CACHE = {
                    ENTRIES_KEY: 'mess_entries_v2',
                    PRICING_KEY: 'mess_pricing_v2',
                    entries: [],
                    pricing: [],
                    loaded: false
                };
                try {
                    var e = localStorage.getItem(window.MESS_CACHE.ENTRIES_KEY);
                    var p = localStorage.getItem(window.MESS_CACHE.PRICING_KEY);
                    if (e) { window.MESS_CACHE.entries = JSON.parse(e); window.MESS_CACHE.loaded = true; }
                    if (p) { window.MESS_CACHE.pricing = JSON.parse(p); }
                    console.log(' PRE-LOADED:', window.MESS_CACHE.entries.length, 'entries from cache!');
                } catch (err) { console.warn('Cache pre-load failed'); }

                window.saveToCache = function (entries, pricing) {
                    try {
                        if (entries) localStorage.setItem(window.MESS_CACHE.ENTRIES_KEY, JSON.stringify(entries));
                        if (pricing) localStorage.setItem(window.MESS_CACHE.PRICING_KEY, JSON.stringify(pricing));
                    } catch (ex) { }
                };
            })();
    </script>

    <!-- Main App Script -->
    <!-- INSTANT CACHE LOADER -->
    <script>
        (function () {
            window.MESS_CACHE = { ENTRIES_KEY: 'mess_entries_v2', PRICING_KEY: 'mess_pricing_v2', entries: [], pricing: [], loaded: false };
            try {
                var e = localStorage.getItem(window.MESS_CACHE.ENTRIES_KEY);
                var p = localStorage.getItem(window.MESS_CACHE.PRICING_KEY);
                if (e) { window.MESS_CACHE.entries = JSON.parse(e); window.MESS_CACHE.loaded = true; }
                if (p) { window.MESS_CACHE.pricing = JSON.parse(p); }
                console.log(' PRE-LOADED:', window.MESS_CACHE.entries.length, 'entries from cache!');
            } catch (err) { }
            window.saveToCache = function (entries, pricing) {
                try { if (entries) localStorage.setItem(window.MESS_CACHE.ENTRIES_KEY, JSON.stringify(entries)); if (pricing) localStorage.setItem(window.MESS_CACHE.PRICING_KEY, JSON.stringify(pricing)); } catch (ex) { }
            };
        })();
    </script>
    <script src="mobile.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('✅ Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❌ Service Worker registration failed:', error);
                    });
            });
        }
    </script>

</body>

</html>